<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="uvalib-model-hours.html">

<!--
`uvalib-model-library`
data model for a range of weeks hours for a library location.

@demo demo/library.html
-->

<dom-module id="uvalib-model-weeks">
  <template>
    <template is="dom-if" if="{{!object}}" restamp>
      <uvalib-model-hours data="{{_data}}" filter="{{_filter}}"/>
    </template>
  </template>

  <script>
    Polymer({

      is: 'uvalib-model-weeks',

      properties: {
        /**
         * The library that is being requested.  If the lid property is not specified and the library property is, then this is used to define which Library is being requested.
         */
        library: {
          value: null,
          type: String,
          notify: true
        },
        /**
         * The Springshare LibCal library identifier. If specified will define which Library is being requested (takes priority over the library property)
         */
        lid: {
          value: null,
          type: String,
          notify: true
        },
        /**
         * The number of week to retrieve, if specified. An integer value between 1 and 52. If not specified, all 52 weeks will be retrieved. 0 represents current week.
         */
        numWeeks: {
          value: 52,
          type: Number,
          notify: true
        },
        /**
         * The location object as it is represented from the API.  If this property is set, the object provided is parsed and used, otherwise this is populated from the API request.
         */
        object: {
          value: null,
          type: Object,
          notify: true
        },
        /**
         * Up to 52 weeks of hours data for a library location.
         */
        data: {
          type: Array,
          computed: '_processList(_data, numWeeks)',
          notify: true,
          readOnly: true
        },
        _data: {
          value: null,
          type: Array,
          observer: "_dataChanged"
        },
        _filter: {
          type: Object,
          computed: '_makeFilter(lid,library)'
        },
        /**
         * The Springshare name of the Library location.
         */
        name: {
          type: String,
          computed: "_name(object)",
          readOnly: true,
          notify: true
        },
        /**
         * Springshare library location category.
         */
        category: {
          type: String,
          computed: "_category(object)",
          readOnly: true,
          notify: true
        },
        /**
         * Springshare library location description.
         */
        description: {
          type: String,
          computed: "_description(object)",
          readOnly: true,
          notify: true
        },
        /**
         * Springshare library location contact information.
         */
        contact: {
          type: String,
          computed: "_contact(object)",
          readOnly: true,
          notify: true
        }

      },

      _dataChanged: function(){
        if (this._data && this._data.length > 0)
          this.object = this._data[0];
      },

      _name: function(obj){
        return (obj && obj.name)? obj.name: '';
      },
      _category: function(obj){
        return (obj && obj.category)? obj.category: '';
      },
      _description: function(obj){
        return (obj && obj.desc)? obj.desc: '';
      },
      _contact: function(obj){
        return (obj && obj.contact)? obj.contact: '';
      },

      _processList: function(){
        if (this._data && this._data.length > 0 && this.numWeeks) {
          return this._data[0].weeks.slice(0,this.numWeeks);
        } else return null;
      },

      _makeFilter: function(lid,library){
        if (lid) {
          return {lid: Number(lid)};
        } else if (library) {
          if (library.includes("Library")) {
            return {name:library};
          } else {
            var libName = library+" Library";
            return {name:libName};
          }
        } else return null;
      }
    });
  </script>
</dom-module>
