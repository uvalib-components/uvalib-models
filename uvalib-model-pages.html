<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymerfire/firebase.html">
<link rel="import" href="../polymerfire/firebase-document.html">
<link rel="import" href="../app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html">
<link rel="import" href="firebase-app.html">
<link rel="import" href="../uvalib-helper-libs/lodash.html">

<!--
`uvalib-model-pages`
data model for the alerts/notifications used on the Library's Web sites

@demo demo/pages.html
-->

<dom-module id="uvalib-model-pages">
  <template>
    <firebase-document id="query" app-name="uvalibapi"
        path="/pages" data="{{tmpData}}" zero-value="[]"></firebase-document>
    <app-indexeddb-mirror
        key="pages"
        data="[[tmpData]]"
        persisted-data="{{data}}">
    </app-indexeddb-mirror>
  </template>

  <script>
    Polymer({

      is: 'uvalib-model-pages',
      properties: {
        /**
         * Path specified in this property will filter the first resource found to the page property
         */
        path: {
          type: String,
          value: null
        },

        /**
         * The Alerts
         *
         * @type {Object[]}
         */
        data: {
          type: Array,
          value: [],
          notify: true
        },

        /**
         * If a path is specified, the page property will the page object
         */
        page: {
          type: Object,
          computed: "_filterPage(path, data)",
          notify: true
        },
      },

      _filterPage: function(path, data){
        if (data && data.length > 0)
          return _.find(data, function(item){
            if (Array.isArray(item.paths))
              return _.findIndex(item.paths, ['paths',path]) > -1;
            else {
              return item.paths == path;
            }
          });
        else
          return null;
      }

    });
  </script>
</dom-module>
